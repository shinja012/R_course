---
title: "R Course - edgeR: part I"
author: "Jay W. Shin"
date: "February 17, 2016"
output: html_document
---

The part I of this edgeR lesson focuses on the pair-wise comparison between two time points. 
The data is availble from <http://fantom.gsc.riken.jp/5/tet>. 

* __Dataset__
* _Human Phase 1 and 2_
    + Expression (read counts) of ruboust phase 1 and 2 CAGE peaks fro human samples with annotation


* __Columns(s)__
* _short description_
    + HES3-GFP Embryonic Stem Cells, cardiomyocytic induction, day00, biol_rep1 (UH-1).CNhs13694.13364-143F7
    + HES3-GFP Embryonic Stem Cells, cardiomyocytic induction, day00, biol_rep2 (UH-2).CNhs13695.13364-143F8
    + HES3-GFP Embryonic Stem Cells, cardiomyocytic induction, day00, biol_rep3 (UH-3).CNhs13698.13364-143F9
    + HES3-GFP Embryonic Stem Cells, cardiomyocytic induction, day12, biol_rep1.CNhs13711.13339-143C9
    + HES3-GFP Embryonic Stem Cells, cardiomyocytic induction, day12, biol_rep2.CNhs13724.13351-143E3
    + HES3-GFP Embryonic Stem Cells, cardiomyocytic induction, day12, biol_rep3.CNhs13736.13363-143F6

* Open and save the filename to "cardio.csv" in Excel

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```

```{r , message=FALSE}
library(edgeR)
```

Import data
```{r }
getwd()
data<-read.csv("cardio.csv", header=TRUE, row.names=1)
colnames(data)
```

Rename data headers
```{r}
colnames(data) = c("Card.D0-1", "Card.D0-2", "Card.D0-3", 
                   "Card.D12-1", "Card.D12-2", "Card.D12-3")

head(data)
```

Grouping
```{r}
#Separates "Card.D0-1" into "Card.D0" and "1"
s<-strsplit(colnames(data), "-")

#Isolate only the first ELEMENT
group<-sapply(1:length(s), function(X) s[[X]][1])

group
```

Filter
```{r}
threshold = 5
f.data = data[rowSums(data) > threshold ,  ]
```

Combine filtered data and Group information and perform dispersion. CommonDispersion should be performed before Tagwise Dispersion. 
```{r}

# Combine data and group
my_data= DGEList(counts=f.data, group=group)

# Common Dispersion
my_data=estimateCommonDisp(my_data) 

# Tagwise Dispersion
my_data=estimateTagwiseDisp(my_data)

plotBCV(my_data)
```

Performs Pair-wise comparison between two time points. 
```{r}

de = exactTest(my_data, pair=c("Card.D0", "Card.D12"), dispersion="tagwise")

```

Perform multiple testing and disply top 10 most significant promoters.
```{r, tidy=TRUE}

# False Discovery Rate (FDR) based on Benjamin-Hochberg (BH)
de$table$FDR=p.adjust(de$table$PValue, method = "BH")

topTags(de, n=10)

```

Select significant promoters (FDR < 0.05)
```{r}
summary(de2 <- decideTestsDGE(de, p=0.05))
detags <- rownames(my_data)[as.logical(de2)]

```

Visualizing MA plot
```{r}
plotSmear(de, de.tags=detags)
abline(h = c(-2, 2), col = "blue")
```

